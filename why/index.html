<html>
  <head>
    <title>why watch worms?</title>
    <script src="oppressive.js"></script>
  </head>
  <body>
    <script>
var Recording = function(id, spec) {
    OP.Objection.call(this, id, spec);
};
Recording.prototype = new OP.Objection;
Recording.prototype.render = function(mode,type) {
    var $d = document.createElement(type||'img');
    $d.src = "data/" + this.filename + mode;
    return $d;
};

var PathADP45 = function(id, spec) {
    OP.Objection.call(this, id, spec);  
};
PathADP45.prototype = new OP.Objection;

var PathMOT60 = function(id, spec) {
    OP.Objection.call(this, id, spec);  
};
PathMOT60.prototype = new OP.Objection;



var STILL_MODES = {"First frame": ".first.png",
                   "ADP45 threshold": ".contoursADP45.png",
                   "MOT60 threshold": ".contoursMOT60.png",
                   "Composite frame": ".comp.png",
                   "ADP45 path": ".pathADP45.png",
                   "MOT60 path": ".pathMOT60.png",
                  }
var VIDEO_MODES = {"Video": ".webm",
                   "ADP45 threshold": ".contoursADP45.webm",
                   "MOT60 threshold": ".contoursMOT60.webm" }

var MultiRec = function(recs) {
    this.recs = recs;
    this.$el = document.createElement('div');
    this.$all = document.createElement('div');
    $sel = document.createElement('select');
    $vsel = document.createElement('select');

    var modes = [];
    for(var key in STILL_MODES) {
        var $opt = document.createElement('option');
        $opt.innerHTML = key;
        $sel.appendChild($opt);
        modes.push(key);
    };
    var that = this;
    $sel.onchange = function(ev) {
        that.render(STILL_MODES[modes[$sel.selectedIndex]]);
    }

    var vmodes = [];
    for(var key in VIDEO_MODES) {
        var $opt = document.createElement('option');
        $opt.innerHTML = key;
        $vsel.appendChild($opt);
        vmodes.push(key);
    };
    $vsel.onchange = function(ev) {
        that.render(VIDEO_MODES[vmodes[$vsel.selectedIndex]], 'video');
    }

    this.$el.appendChild($sel);
    this.$el.appendChild($vsel);
    this.$el.appendChild(this.$all);
    this.render(STILL_MODES['First frame']);
};
MultiRec.prototype.render = function(mode,type) {
    var $a = this.$all;
    $a.innerHTML = "";
    this.recs.forEach(function(r) {
        $a.appendChild(r.render(mode,type));
    });
};

var MR = null;

OP.Subjectification.load(
    {'Recording.json': Recording,
     'PathADP45.json': PathADP45, 
     'PathMOT60.json': PathMOT60 }, function() {

    MR = new MultiRec(OP.Subjectification.all(Recording));
    document.body.appendChild(MR.$el);

});

    </script>
  </body>
</html>
